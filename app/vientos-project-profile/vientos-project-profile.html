<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">

<link rel="import" href="../../bower_components/vientos-iconset/vientos-iconset.html">
<link rel="import" href="../components/vientos-icon-button/vientos-icon-button.html">

<link rel="import" href="../intent-preview/intent-preview.html">

<link rel="import" href="vientos-project-profile-styles.html">

<dom-module id="vientos-project-profile">
  <template>

    <style include="vientos-project-profile-styles"></style>

    <header>
      <div><paper-icon-button icon="arrow-back" on-tap="_back"></paper-icon-button></div>
      <h2>
        [[project.name]]
      </h2>
    </header>

    <template is="dom-if" if="[[canFollow]]">
      <section class="action-buttons">
        <template is="dom-if" if="[[!following]]">
          <vientos-icon-button
          raised
          icon="vientos:follow"
          text="[[localize('button:follow')]]"
          on-tap="_follow"
          ></vientos-icon-button>
        </template>
        <template is="dom-if" if="[[following]]">
          <vientos-icon-button
          raised
          icon="vientos:unfollow"
          text="[[localize('button:unfollow')]]"
          on-tap="_unfollow"
          ></vientos-icon-button>
        </template>
      </section>
    </template>
    <template is="dom-if" if="[[admin]]">
      <section class="action-buttons">
        <vientos-icon-button
          raised
          on-tap="_editDetails"
          text="[[localize('button:edit')]]">
        </vientos-icon-button>
        <vientos-icon-button
          raised
          on-tap="_startAddingAdmin"
          text="[[localize('button:add-admin')]]"
          disabled="[[addingNewAdmin]]">
        </vientos-icon-button>
      </section>
      <section>
        <h3>[[localize('label:admins')]]</h3>
        <template is="dom-if" if="[[addingNewAdmin]]">
          <div>
            <paper-dropdown-menu label="[[localize('label:select-new-admin')]]">
              <paper-listbox
                class="dropdown-content"
                attr-for-selected="name"
                on-iron-select="_setNewAdmin">
                <template is="dom-repeat" items="[[potentialAdmins]]">
                  <paper-item name="[[item._id]]">[[item.name]]</paper-item>
                </template>
              </paper-listbox>
            </paper-dropdown-menu>
            <paper-button raised on-tap="_addNewAdmin" disabled="[[!newAdmin]]">[[localize('button:save')]]</paper-button>
            <paper-button raised on-tap="_cancelAddingAdmin">[[localize('button:cancel')]]</paper-button>
          </div>
        </template>
        <ul id="admin-list">
          <template is="dom-repeat" items="[[_getRef(project.admins, people)]]">
            <li>
              <iron-image src="[[item.logo]]" sizing="contain"></iron-image>
              [[item.name]]
            </li>
          </template>
        </ul>
      </section>
    </template>

    <section id="logo">
      <template is="dom-if" if="[[project.logo]]">
        <iron-image src="[[project.logo]]" sizing="contain"></iron-image>
      </template>
    </section>
    <template is="dom-if" if="[[project.description]]">
      <section id="project-description">
        [[project.description]]
      </section>
    </template>
    <section id="project-location">
      <ul>
        <template is="dom-repeat" items="[[project.locations]]" as="placeId">
          <li>
            <vientos-icon-button
              raised
              ellipsis
              on-tap="_showLocationOnMap"
              icon="vientos:crosshairs"
              text="[[_getPlaceAddress(placeId, places)]]">
            </vientos-icon-button>
          </li>
        </template>
      </ul>
    </section>
    <template is="dom-if" if="[[project.categories]]">
      <section id="categories">
        <h3>[[localize('label:categories')]]</h3>
        <ul>
          <template is="dom-repeat" items="[[project.categories]]" as="category">
            <li>
              <iron-icon icon="vientos:[[category]]"></iron-icon>
              [[localize(category)]]
            </li>
          </template>
        </ul>
      </section>
    </template>
    <template is="dom-if" if="[[_showLinksAndContacts(project)]]">
      <section>
        <h3>[[localize('label:contacts-links')]]</h3>
        <ul>
        <template is="dom-repeat" items="[[project.links]]">
          <li><a href="[[item]]" target="_blank">[[item]]</a></li>
        </template>
        </ul>
        <ul>
        <template is="dom-repeat" items="[[project.contacts]]">
          <li>[[item]]</li>
        </template>
        </ul>
      </section>
    </template>


<template is="dom-if" if="[[admin]]">
  <paper-button class="primary-action" on-tap="_newIntent">
    <iron-icon icon="vientos:add-intent"></iron-icon>
    [[localize('button:add-intent')]]
  </paper-button>
</template>

<section id="active-intents">
  <h3>
    [[localize('intents')]]
  </h3>
  <div>
    <template is="dom-repeat" items="[[activeIntents]]">
      <intent-preview intent="[[item]]"></intent-preview>
    </template>
  </div>

</section>
<template is="dom-if" if="[[admin]]">
  <section id="expired-intents">
    <h3>
      [[localize('label:expired-intents')]]
    </h3>
    <div>
      <template is="dom-repeat" items="[[expiredIntents]]">
        <intent-preview intent="[[item]]"></intent-preview>
      </template>
    </div>
  </section>
  <section id="inactive-intents">
    <h3>
      [[localize('label:inactive-intents')]]
    </h3>
    <div>
      <template is="dom-repeat" items="[[inactiveIntents]]">
        <intent-preview intent="[[item]]"></intent-preview>
      </template>
    </div>
  </section>
</template>

  </template>

  <script src="vientos-project-profile.js"></script>

</dom-module>
