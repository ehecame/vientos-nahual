<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="../../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-badge/paper-badge.html">

<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,900" rel="stylesheet">

<link rel="import" href="../../bower_components/vientos-iconset/vientos-iconset.html">
<link rel="import" href="vientos-shell-styles.html">

<dom-module id="vientos-shell">
  <template>

  <style include="vientos-shell-styles"></style>


  <app-location route="{{route}}"></app-location>

  <app-route
  route="{{route}}"
  pattern="/:page"
  data="{{routeData}}"
  tail="{{subroute}}"></app-route>

  <app-route
  route="{{subroute}}"
  pattern="/:id"
  data="{{subrouteData}}"></app-route>

  <div>

    <!-- Main content -->
    <app-header-layout>
      <div id="app-container">
        <iron-pages
        selected="{{page}}"
        attr-for-selected="name"
        role="main">
        <!-- TODO: fallback-selection="view404" -->

          <search-and-filter name="search-and-filter"></search-and-filter>

          <div name="projects">
            <iron-list
              id="list"
              items="[[visibleProjects]]"
              as="organization">
              <template>
                <organization-preview organization="[[organization]]"></organization-preview>
              </template>
            </iron-list>
          </div>

          <div name="intents">
            <iron-list
              id="intents"
              items="[[visibleIntents]]"
              as="intent">
              <template>
                <intent-preview intent="[[intent]]" show-projects></intent-preview>
              </template>
            </iron-list>
          </div>

          <div name="menu">
            <ul>
              <li><a href="/guide">[[localize('guide')]]</a></li>
              <li><a href="/account">[[localize('button:account-settings')]]</a></li>
              <li><a href="/new-project">[[localize('button:add-project')]]</a></li>
              <li><a href="/" on-tap="_logout">[[localize('button:logout')]]</a></li>
            </ul>
          </div>


          <organization-profile
          name="project"
          project="[[currentProject]]"></organization-profile>

          <organization-editor
          name="edit-project-details"
          project="[[currentProject]]"></organization-editor>

          <organization-editor
          name="new-project"
          creator="[[person]]"></organization-editor>

          <intent-details
          name="intent"
          intent="[[currentIntent]]"></intent-details>

          <intent-editor
          name="edit-intent"
          intent="[[currentIntent]]"></intent-editor>

          <intent-editor
          name="new-intent"
          project="[[currentProject]]"></intent-editor>

          <vientos-inbox name="me"></vientos-inbox>
          <account-settings name="account"></account-settings>

          <start-conversation
          name="new-conversation"
          intent="[[currentIntent]]"></start-conversation>

          <vientos-conversation
          name="conversation"
          conversation="[[currentConversation]]"></vientos-conversation>

          <place-details
          name="place"
          place="[[currentPlace]]"></place-details>

          <vientos-guide
          name="guide"></vientos-guide>
        </iron-pages>
        <vientos-map
          view="[[mapView]]"
          locations="[[visiblePlaces]]"
          of="[[mapOf]]"
          on-bbox="_updateBoundingBox"
          ></vientos-map>
      </div>


      <!-- <template is="dom-if" if="[[mapButtonVisible]]">
        <paper-button class="primary-action" on-tap="_showMap">
          <iron-icon icon="vientos:map"></iron-icon>
          [[localize('button:map')]]
        </paper-button>
      </template>
      <template is="dom-if" if="[[listButtonVisible]]">
        <paper-button class="primary-action" on-tap="_showList">
          <iron-icon icon="vientos:list"></iron-icon>
          [[localize('button:list')]]
        </paper-button>
      </template>
      <template is="dom-if" if="[[placeInfoButtonVisible]]">
        <paper-button class="primary-action" on-tap="_showList">
          <iron-icon icon="vientos:place"></iron-icon>
          [[localize('label:address')]]
        </paper-button>
      </template> -->

      <template is="dom-if" if="[[_hasFooter(page)]]">
        <footer>
          <iron-selector selected="{{page}}" attr-for-selected="name" role="navigation">
           <paper-button name="intents">
             <iron-icon id="intents-icon" icon="vientos:intent"></iron-icon>
             <template is="dom-if" if="[[filterActive]]">
               <paper-badge label="[[visibleIntents.length]]" for="intents-icon"></paper-badge>
             </template>
           </paper-button>
            <paper-button name="projects">
              <iron-icon id="projects-icon" icon="vientos:organization"></iron-icon>
              <template is="dom-if" if="[[filterActive]]">
                <paper-badge label="[[visibleProjects.length]]" for="projects-icon"></paper-badge>
              </template>
            </paper-button>
            <template is="dom-if" if="[[person]]">
              <paper-button name="me">
                <iron-image id="person-avatar" src="[[_getThumbnailUrl(person, 26)]]" sizing="cover"></iron-image>
                <template is="dom-if" if="[[notifications.length]]">
                  <paper-badge label="[[notifications.length]]" for="person-avatar"></paper-badge>
                </template>
              </paper-button>
            </template>
            <template is="dom-if" if="[[!person]]">
              <paper-button name="me">
                <iron-icon icon="vientos:person"></iron-icon>
              </paper-button>
            </template>
            <paper-button name="menu">
              <iron-icon icon="vientos:menu"></iron-icon>
            </paper-button>
          </iron-selector>
        </footer>
      </template>

  </app-header-layout>
</div>

</template>

<script src="vientos-shell.js"></script>

</dom-module>
