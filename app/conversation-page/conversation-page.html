<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/vientos-iconset/vientos-iconset.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">

<link rel="import" href="../components/vientos-icon-button/vientos-icon-button.html">

<link rel="import" href="../intent-preview/intent-preview.html">

<link rel="import" href="../vientos-styles/vientos-styles.html">
<link rel="import" href="conversation-page-styles.html">

<dom-module id="conversation-page">
  <template>
    <style include="conversation-page-styles"></style>

    <section>
      <intent-preview intent="[[causingIntent]]" show-projects></intent-preview>
      <template is="dom-if" if="[[matchingIntent]]">
        <intent-preview intent="[[matchingIntent]]" show-projects></intent-preview>
      </template>
    </section>
    <section>
      <ul>
        <li>
          <p>[[localize('label:questions')]]</p>
          <p>[[causingIntent.question]]</p>
        </li>
        <template is="dom-repeat" items="[[conversation.messages]]" as="message">
          <li>
            <p>
              <iron-image src="[[_getCreatorAvatar(message.creator)]]" sizing="contain"></iron-image>
              [[_getCreatorName(message.creator)]]
            </p>
            <p>[[message.body]]</p>
          </li>
        </template>
      </ul>
      <template is="dom-if" if="[[showNewMessage]]">
        <paper-textarea
          value="{{newMessage}}"
          autofocus>
        </paper-textarea>
        <div>
          <div id="turn-toggle">
            <span>[[localize('label:our-turn')]]</span>
            <paper-toggle-button toggles checked="[[turnToggleChecked]]" on-tap="_toggleTurn"></paper-toggle-button>
            <span>[[localize('label:their-turn')]]</span>
          </div>
          <paper-button raised on-tap="_sendMessage" disabled="[[!newMessage]]">[[localize('button:send')]]</paper-button>
        </div>
      </template>
    </section>
    <!-- TODO EDIT COLLABORATION SECTION PENDING https://github.com/vientos/vientos-pwa/blob/fd4de78d88f0427b770b890cd2102e7ee469f77b/app/conversation-page/conversation-page.html#L53-L71-->
    <section>
      <h3>[[localize('label:reviews')]]</h3>
      <template is="dom-repeat" items="[[conversation.reviews]]" as="review">
        <div>
          <iron-image src="[[_getCreatorAvatar(review.creator)]]" sizing="contain"></iron-image>
          [[_getCreatorName(review.creator)]]
        </div>
        <div>[[review.body]]</div>
      </template>
      <template is="dom-if" if="[[_showNewReview(conversation, canReview, reviewing)]]">
        <p>:) :| :(</p>
        <paper-textarea
          value="{{newReview}}">
        </paper-textarea>
        <paper-button raised on-tap="_sendReview" disabled="[[!newReview]]">[[localize('button:review')]]</paper-button>
        <template is="dom-if" if="[[!conversation.reviews.length]]">
          <paper-button raised on-tap="_abortReview">[[localize('button:cancel')]]</paper-button>
        </template>
      </template>
      <template is="dom-if" if="[[_showReviewButton(person, conversation, reviewing, editingCollaboration)]]">
        <div>
          <paper-button raised on-tap="_abort">[[localize('button:abort')]]</paper-button>
          <!-- <template is="dom-if" if="[[conversation.collaboration.body]]"> -->
          <paper-button raised on-tap="_succeed">[[localize('button:succeed')]]</paper-button>
          <!-- </template> -->
        </div>
      </template>
    </section>
  </template>

  <script src="conversation-page.js"></script>

</dom-module>
