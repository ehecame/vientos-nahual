<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/vientos-iconset/vientos-iconset.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">

<link rel="import" href="../components/vientos-icon-button/vientos-icon-button.html">
<link rel="import" href="../open-conversations/open-conversations.html">

<link rel="import" href="../../bower_components/vientos-iconset/vientos-iconset.html">
<link rel="import" href="../vientos-styles/vientos-styles.html">
<link rel="import" href="vientos-intent-page-styles.html">

<dom-module id="vientos-intent-page">
  <template>
    <style include="vientos-intent-page-styles"></style>

    <template is="dom-if" if="[[admin]]">
      <paper-button
        raised
        on-tap="_editIntent">
        [[localize('button:edit')]]
      </paper-button>
    </template>

    <section>
      <template is="dom-if" if="[[_canFavor(person, admin)]]">
        <template is="dom-if" if="[[!favoring]]">
          <vientos-icon-button
          raised
          icon="vientos:favor"
          text="[[localize('button:favor')]]"
          on-tap="_favor"
          ></vientos-icon-button>
        </template>
        <template is="dom-if" if="[[favoring]]">
          <vientos-icon-button
          raised
          icon="vientos:unfavor"
          text="[[localize('button:unfavor')]]"
          on-tap="_unfavor"
          ></vientos-icon-button>
        </template>
      </template>
    </section>

    <template is="dom-if" if="[[_showConversations(admin, conversations)]]">
      <h3>
        <iron-icon icon="vientos:conversation"></iron-icon>
        [[localize('label:open-conversations')]]
      </h3>
      <open-conversations conversations="[[conversations]]"></open-conversations>
    </template>

    <h2>[[intent.title]]</h2>
    <p>[[localize(intent.direction)]]</p>

    <section>
      <h3>[[localize('label:description')]]</h3>
      <p>[[intent.description]]</p>
      <template is="dom-if" if="[[intent.logo]]">
        <iron-image src="[[_getThumbnailUrl(intent.logo, 200)]]" sizing="contain"></iron-image>
      </template>
      <template is="dom-if" if="[[intent.locations.length]]">
        <h3>[[localize('label:address')]]</h3>
        <p>
          <ul>
            <template is="dom-repeat" items="[[intent.locations]]" as="placeId">
              <li>
                <vientos-icon-button
                  raised
                  on-tap="_showLocationOnMap"
                  icon="vientos:crosshairs"
                  text="[[_getPlaceAddress(placeId, places)]]">
                </vientos-icon-button>
              </li>
            </template>
          </ul>
        </p>
      </template>
      <h3>[[localize('label:collaboration-type')]]</h3>
      <p>[[localize(intent.collaborationType)]]</p>
      <h3>[[localize('label:collaboration-condition')]]</h3>
      <p>[[localize(intent.condition)]]</p>
      <h3>[[localize('label:expiry-date')]]</h3>
      <p>[[intent.expiryDate]]</p>
    </section>

    <section>
      <h3>
        <iron-icon icon="vientos:organization"></iron-icon>
        [[localize('label:projects')]]
      </h3>
      <ul id="projects">
        <template is="dom-repeat" items="[[_getRef(intent.projects, projects)]]" as="project">
          <li on-tap="_showProjectProfile">
            <iron-image
               src="[[_getThumbnailUrl(project.logo, 26)]]"
               sizing="contain">
            </iron-image>
            [[project.name]]
          </li>
        </template>
      </ul>
    </section>
    <!-- <template is="dom-if" if="[[intentCollaborations.length]]">
      <section>
        <h3>
          <iron-icon icon="vientos:success"></iron-icon>
          [[localize('label:collaborations')]]
        </h3>
        <ul>
          <template is="dom-repeat" items="[[intentCollaborations]]" as="collaboration">
            <li>
              <div>[[collaboration.body]]</div>
              <template is="dom-repeat" items="[[_reviewsOfCollaboration(collaboration, reviews)]]" as="review">
                <p>[[review.body]]</p>
              </template>
            </li>
          </template>
        </ul>
      </section>
    </template> -->
    <template is="dom-if" if="[[successfulReviewGroups.length]]">
      <section>
        <h3>[[localize('label:collaborations')]]</h3>
        <ul>
          <template is="dom-repeat" items="[[successfulReviewGroups]]" as="reviewGroup">
            <li>
              <template is="dom-repeat" items="[[reviewGroup]]" as="review">
                <p>[[review.body]]</p>
              </template>
            </li>
          </template>
        </ul>
      </section>
    </template>
    <template is="dom-if" if="[[abortedReviewGroups.length]]">
      <section>
        <h3>[[localize('label:reviews-aborted')]]</h3>
        <ul>
          <template is="dom-repeat" items="[[abortedReviewGroups]]" as="reviewGroup">
            <li>
              <template is="dom-repeat" items="[[reviewGroup]]" as="review">
                <p>[[review.body]]</p>
              </template>
            </li>
          </template>
        </ul>
      </section>
    </template>
    <template is="dom-if" if="[[_showFab(person, admin)]]">
      <template is="dom-if" if="[[!currentConversation]]">
        <paper-fab id="start" icon="vientos:conversation" on-tap="_startConversation"></paper-fab>
      </template>
      <template is="dom-if" if="[[currentConversation]]">
        <paper-fab id="continue" icon="vientos:conversation" on-tap="_continueConversation"></paper-fab>
      </template>
    </template>
  </template>

  <script src="vientos-intent-page.js"></script>

</dom-module>
