<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">

<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/vientos-iconset/vientos-iconset.html">

<link rel="import" href="../components/vientos-icon-button/vientos-icon-button.html">
<link rel="import" href="../open-conversations/open-conversations.html">
<link rel="import" href="../cards/review-card/review-card.html">

<link rel="import" href="vientos-intent-page-styles.html">

<dom-module id="vientos-intent-page">
  <template>
    <style include="vientos-intent-page-styles"></style>

    <header>
      <div><paper-icon-button icon="arrow-back" on-tap="_back"></paper-icon-button></div>
      <h2>
        [[intent.title]]
      </h2>
    </header>
    <template is="dom-if" if="[[!active]]">
      <div class="banner">[[localize('hint:inactive')]]</div>
    </template>
    <template is="dom-if" if="[[expired]]">
      <div class="banner">[[localize('hint:expired')]]</div>
      <template is="dom-if" if="[[!active]]">
        <div class="hint">[[localize('hint:to-activate-expired')]]</div>
      </template>
    </template>
    <template is="dom-if" if="[[projectAdmin]]">
      <section class="action-buttons">
        <template is="dom-if" if="[[intentAdmin]]">
          <vientos-icon-button
            raised
            on-tap="_edit"
            text="[[localize('button:edit')]]">
          </vientos-icon-button>
          <template is="dom-if" if="[[active]]">
            <vientos-icon-button
              raised
              on-tap="_deactivate"
              text="[[localize('button:deactivate')]]">
            </vientos-icon-button>
          </template>
          <template is="dom-if" if="[[!active]]">
            <vientos-icon-button
              raised
              on-tap="_activate"
              text="[[localize('button:activate')]]"
              disabled="[[expired]]"
            ></vientos-icon-button>
          </template>
          <vientos-icon-button
            raised
            text="[[localize('button:leave-admin')]]"
            on-tap="_leaveAdmin"
            disabled="[[!_canLeaveAdmin(intent, intentAdmin)]]"
          ></vientos-icon-button>
        </template>
        <template is="dom-if" if="[[!intentAdmin]]">
          <vientos-icon-button
          raised
          text="[[localize('button:become-admin')]]"
          on-tap="_becomeAdmin"
          ></vientos-icon-button>
        </template>
      </section>
      <section>
        <h3>[[localize('label:admins')]]</h3>
        <ul id="admin-list">
          <template is="dom-repeat" items="[[_getRef(intent.admins, people)]]">
            <li>
              <iron-image src="[[item.logo]]" sizing="contain"></iron-image>
              [[item.name]]
            </li>
          </template>
        </ul>
      </section>
    </template>

    <template is="dom-if" if="[[_canFavor(person, projectAdmin)]]">
      <section class="action-buttons">
        <template is="dom-if" if="[[!favoring]]">
          <vientos-icon-button
          raised
          icon="vientos:favor"
          text="[[localize('button:favor')]]"
          on-tap="_favor"
          ></vientos-icon-button>
        </template>
        <template is="dom-if" if="[[favoring]]">
          <vientos-icon-button
          raised
          icon="vientos:unfavor"
          text="[[localize('button:unfavor')]]"
          on-tap="_unfavor"
          ></vientos-icon-button>
        </template>
      </section>
    </template>

    <template is="dom-if" if="[[_showConversations(intentAdmin, conversations)]]">
      <section>
        <h3>
          [[localize('label:open-conversations')]]
        </h3>
        <open-conversations conversations="[[conversations]]" intent="[[intent]]"></open-conversations>
      </section>
    </template>

    <section>
      <h3>
        [[localize('label:projects')]]
      </h3>
      <ul id="projects">
        <template is="dom-repeat" items="[[intentProjects]]" as="project">
          <li on-tap="_showProjectProfile" class="clickable">
            <iron-image
               src="[[_getThumbnailUrl(project, 26)]]"
               sizing="contain">
            </iron-image>
            [[project.name]]
          </li>
        </template>
      </ul>
    </section>
    <section>
      <iron-icon icon="vientos:[[intent.direction]]"></iron-icon>
      [[localize(intent.direction)]]
    </section>
    <section id="description">
      <h3>[[localize('label:description')]]</h3>
      <div>[[intent.description]]</div>
      <template is="dom-if" if="[[intent.logo]]">
        <div id="logo">
          <iron-image src="[[_getThumbnailUrl(intent, 200)]]" sizing="contain"></iron-image>
        </div>
      </template>
    </section>
    <section>
      <template is="dom-if" if="[[intent.locations.length]]">
        <h3>[[localize('label:address')]]</h3>
        <div>
          <ul>
            <template is="dom-repeat" items="[[intent.locations]]" as="placeId">
              <li>
                <vientos-icon-button
                  raised
                  on-tap="_showLocationOnMap"
                  icon="vientos:crosshairs"
                  text="[[_getPlaceAddress(placeId, places)]]">
                </vientos-icon-button>
              </li>
            </template>
          </ul>
        </div>
      </template>
    </section>
    <section>
      <h3>[[localize('label:collaboration-type')]]</h3>
      <div>
        <iron-icon icon="vientos:[[intent.collaborationType]]"></iron-icon>
        [[localize(intent.collaborationType)]]
      </div>
    </section>
    <section>
      <h3>[[localize('label:reciprocity')]]</h3>
      <div>
        <iron-icon icon="vientos:[[intent.reciprocity]]"></iron-icon>
        [[localize(intent.reciprocity)]]
      </div>
    </section>
    <section>
      <h3>[[localize('label:expiry-date')]]</h3>
      <div>[[intent.expiryDate]]</div>
    </section>

    <section id="stats">
      <h3>[[localize('stats')]]</h3>
      <span>
        <iron-icon icon="vientos:conversation"></iron-icon>
        [[intent.openConversations.length]]
      </span>
      <span>
        <iron-icon icon="vientos:success"></iron-icon>
        [[intent.collaborations.length]]
        [[intent.successfulConversations.length]]
      </span>
      <span>
        <iron-icon icon="vientos:aborted"></iron-icon>
        [[intent.abortedConversations.length]]
      </span>
    </section>
    <!-- <template is="dom-if" if="[[intentCollaborations.length]]">
      <section>
        <h3>
          <iron-icon icon="vientos:success"></iron-icon>
          [[localize('label:collaborations')]]
        </h3>
        <ul>
          <template is="dom-repeat" items="[[intentCollaborations]]" as="collaboration">
            <li>
              <div>[[collaboration.body]]</div>
              <template is="dom-repeat" items="[[_reviewsOfCollaboration(collaboration, reviews)]]" as="review">
                <div>[[review.body]]</div>
              </template>
            </li>
          </template>
        </ul>
      </section>
    </template> -->
    <template is="dom-if" if="[[successfulReviewGroups.length]]">
      <section class="reviews">
        <h3>[[localize('label:collaborations')]]</h3>
        <ul>
          <template is="dom-repeat" items="[[successfulReviewGroups]]" as="reviewGroup">
            <li>
              <template is="dom-repeat" items="[[reviewGroup]]" as="review">
                <review-card review="[[review]]"></review-card>
              </template>
            </li>
          </template>
        </ul>
      </section>
    </template>
    <template is="dom-if" if="[[abortedReviewGroups.length]]">
      <section class="reviews">
        <h3>[[localize('label:reviews-aborted')]]</h3>
        <ul>
          <template is="dom-repeat" items="[[abortedReviewGroups]]" as="reviewGroup">
            <li>
              <template is="dom-repeat" items="[[reviewGroup]]" as="review">
                <review-card review="[[review]]"></review-card>
              </template>
            </li>
          </template>
        </ul>
      </section>
    </template>
    <template is="dom-if" if="[[_showPrimaryAction(person, projectAdmin)]]">
      <template is="dom-if" if="[[!currentConversation]]">
        <paper-button class="primary-action" id="start" on-tap="_startConversation">
          <iron-icon icon="vientos:conversation"></iron-icon>
          [[localize('button:start-conversation')]]
        </paper-button>
      </template>
      <template is="dom-if" if="[[currentConversation]]">
        <paper-button class="primary-action" id="continue" on-tap="_continueConversation">
          <iron-icon icon="vientos:conversation"></iron-icon>
          [[localize('button:continue-conversation')]]
        </paper-button>
      </template>
    </template>
  </template>

  <script src="vientos-intent-page.js"></script>

</dom-module>
